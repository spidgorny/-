name: Build Markdown to HTML

on:
  push:
    branches: [ main ]
    paths:
      - '**. md'
  workflow_dispatch:

jobs:
  build:
    runs-on:  ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses:  actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install markdown-it
        run: npm install -g markdown-it markdown-it-cli
      
      - name: Convert Markdown to HTML
        run: |
          # Find all markdown files and convert them to HTML
          find . -name "*.md" -type f | while read -r file; do
            # Get the directory and filename without extension
            dir=$(dirname "$file")
            filename=$(basename "$file" .md)
            
            # Convert to HTML with basic styling
            markdown-it "$file" > "${dir}/${filename}.html"
            
            echo "Converted: $file -> ${dir}/${filename}.html"
          done
      
      - name: Add CSS wrapper to HTML files
        run: |
          # Add basic HTML structure and styling to each HTML file
          find . -name "*.html" -type f | while read -r file; do
            filename=$(basename "$file")
            
            # Create a temporary file with full HTML structure
            cat > "${file}.tmp" << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FILENAME</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom:  16px;
            font-weight: 600;
            line-height: 1.25;
        }
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        code {
            background-color: #f6f8fa;
            padding:  0.2em 0.4em;
            border-radius: 3px;
            font-family:  'Courier New', monospace;
        }
        pre {
            background-color: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow:  auto;
        }
        pre code {
            background-color:  transparent;
            padding: 0;
        }
        a {
            color: #0366d6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        table {
            border-collapse: collapse;
            width:  100%;
            margin: 16px 0;
        }
        table th, table td {
            border: 1px solid #dfe2e5;
            padding:  6px 13px;
        }
        table th {
            background-color: #f6f8fa;
            font-weight: 600;
        }
        blockquote {
            border-left: 4px solid #dfe2e5;
            padding:  0 16px;
            color: #6a737d;
            margin: 0;
        }
    </style>
</head>
<body>
EOF
            
            # Replace FILENAME placeholder
            sed -i "s/FILENAME/${filename}/" "${file}.tmp"
            
            # Append the converted content
            cat "$file" >> "${file}.tmp"
            
            # Close HTML tags
            cat >> "${file}.tmp" << 'EOF'
</body>
</html>
EOF
            
            # Replace the original file
            mv "${file}.tmp" "$file"
            
            echo "Added HTML wrapper to: $file"
          done
      
      - name:  Commit HTML files
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add -A
          git diff --staged --quiet || git commit -m "Auto-generate HTML from Markdown files"
          git push
